<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoalCompass</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&family=Noto+Sans+JP:wght@300;400;500;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="chart.js"></script>
</head>

<body>
    <div class="background-globes">
        <div class="globe globe-1"></div>
        <div class="globe globe-2"></div>
        <div class="globe globe-3"></div>
    </div>

    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="logo">
                <i class="fa-solid fa-compass"></i>
                <span>GoalCompass</span>
            </div>

            <ul class="nav-links" id="nav-links">
                <li class="nav-item active" data-target="dashboard" draggable="true">
                    <i class="fa-solid fa-grip-vertical drag-handle"></i>
                    <i class="fa-solid fa-chart-pie"></i>
                    <span>データベース</span>
                </li>
                <li class="nav-item" data-target="goal-setting" draggable="true">
                    <i class="fa-solid fa-grip-vertical drag-handle"></i>
                    <i class="fa-solid fa-bullseye"></i>
                    <span>目的・目標</span>
                </li>
                <li class="nav-item" data-target="routine" draggable="true">
                    <i class="fa-solid fa-grip-vertical drag-handle"></i>
                    <i class="fa-solid fa-list-check"></i>
                    <span>日誌・習慣</span>
                </li>
            </ul>

            <div class="user-profile">
                <div class="avatar">H</div>
                <span>User</span>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">

            <!-- Dashboard Section -->
            <section id="dashboard" class="page-section active">
                <header class="section-header">
                    <h1>データベース</h1>
                    <p>継続的なデータの可視化</p>
                </header>

                <!-- Dashboard Tabs -->
                <div class="dashboard-tabs">
                    <div class="dash-tab-group">
                        <button class="dash-tab-btn active" data-tab="analysis">分析データ</button>
                        <!-- <button class="dash-tab-btn" data-tab="archive">アーカイブ</button> -->
                    </div>
                    <div class="dashboard-links">
                        <a class="dash-link-btn" href="https://notebooklm.google.com/notebook/36ddcc11-1079-45d1-80f1-11db626e7664"
                            target="_blank" rel="noopener">日記を見る</a>
                        <a class="dash-link-btn" href="https://docs.google.com/spreadsheets/d/1S7mzCdS7nYxyKq2bJ9GtHYnPpvb8Mh2oaeRdlOkT1Mw/edit?gid=0#gid=0"
                            target="_blank" rel="noopener">Sheet</a>
                    </div>
                </div>

                <!-- Analysis Panel (Main) -->
                <div class="dashboard-panel active" id="panel-analysis">
                    <!-- 1. Habit Matrix (Full Width) -->
                    <div class="card matrix-card">
                        <div class="card-header-row">
                            <h3>習慣マトリックス (直近14日間)</h3>
                            <button id="btn-refresh-data" class="icon-btn" title="データ更新"><i
                                    class="fa-solid fa-arrows-rotate"></i></button>
                        </div>
                        <div class="matrix-container" id="habit-matrix-view">
                            <div class="loading-spinner">Loading data...</div>
                        </div>
                    </div>

                    <div class="dashboard-grid-2col">
                        <!-- 3. Streak & Stats -->
                        <div class="card stats-card">
                            <div class="card-header-row">
                                <h3>継続ストリーク</h3>
                                <button id="btn-streak-sort" class="btn-xs" title="表示順を切り替え">多→少</button>
                            </div>
                            <div class="streak-list" id="streak-list-view">
                                <!-- Generated by JS -->
                            </div>
                        </div>

                        <!-- 2. Balance Radar -->
                        <div class="card chart-card">
                            <h3>心技体バランス (週間平均)</h3>
                            <div class="chart-container">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Archived Widgets (Hidden by default or moved here) -->
                <!-- 
                <div class="dashboard-grid archive-section" style="display:none;">
                    <div class="card main-goal-card">...</div>
                    <div class="card routine-summary-card">...</div>
                    <div class="card motivation-card">...</div>
                </div>
                -->
            </section>

            <!-- Goal Setting Section -->
            <section id="goal-setting" class="page-section">
                <header class="section-header">
                    <h1>目的・目標設定</h1>
                    <p>目標とKPIをしっかり確認しよう！</p>
                </header>

                <div class="goal-form-container">

                    <!-- AI Assistant Banner (ARCHIVED)
                    <div class="ai-assistant-banner" id="btn-open-ai-wizard">
                        <div class="ai-icon"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
                        <div class="ai-text">
                            <h3>AIアシスタントで目標を設定</h3>
                            <p>5つの質問に答えるだけで、目標と4観点を自動生成します</p>
                        </div>
                        <i class="fa-solid fa-chevron-right"></i>
                    </div>
                    -->

                    <div class="card main-input-group" style="margin-top: 1.5rem;">
                        <label>達成したい目標（メインテーマ）</label>
                        <textarea id="goal-input" rows="3" placeholder="TOEICで900点を獲得して、海外で働く！"
                            style="resize: vertical;"></textarea>

                        <label>達成期日</label>
                        <input type="date" id="deadline-input">
                    </div>

                    <!-- KPI Section (SMART - Measurable) -->
                    <div class="card kpi-section">

                        <div class="kpi-grid" id="kpi-container">
                            <!-- KPIs will be dynamically generated by JS -->
                        </div>
                        <button class="btn-add-kpi" id="add-kpi-btn">
                            <i class="fa-solid fa-plus"></i> KPIを追加
                        </button>
                    </div>

                    <button class="btn-primary" id="save-goal-btn">
                        <i class="fa-solid fa-save"></i> 設定を保存
                    </button>
                </div>
            </section> <!-- Mandala Section -->

            <!--
            =====================================================
            ARCHIVED: Supporters & Mental Control Sections
            (These sections are commented out. Restore from git if needed.)
            =====================================================
            -->

            <section id="routine" class="page-section">
                <header class="section-header">
                    <h1>日誌・習慣ログ</h1>
                    <p>毎日の習慣チェックと振り返りをまとめて記録</p>
                <!-- Daily Journal -->
                <div class="journal-wrapper card">
                    <header class="journal-header-compact">
                        <div class="date-nav-compact">
                            <button id="prev-date"><i class="fa-solid fa-chevron-left"></i></button>
                            <input type="date" id="journal-date" class="date-input-transparent">
                            <button id="next-date"><i class="fa-solid fa-chevron-right"></i></button>
                            <a href="#section-score" id="btn-speed-review" class="btn-xs"
                                style="margin-left: 1rem; text-decoration: none; display: inline-flex; align-items: center; cursor: pointer; color: inherit;"
                                title="スコアセクションへ移動"><i class="fa-solid fa-rocket"
                                    style="margin-right: 0.5rem;"></i>Speed Review</a>
                        </div>
                        <div class="save-status" id="journal-status"></div>
                    </header>

                    <div class="journal-content-grid">
                        <!-- Left Col: Morning & Intention -->
                        <div class="journal-body">
                            <!-- Section: Morning Plan -->

                            <div class="form-group" style="margin-bottom: 0.5rem;">
                                <label class="section-label"><i class="fa-solid fa-pen"></i> タイトル</label>
                                <input type="text" id="journal-declaration" class="journal-input"
                                    placeholder="1日を笑顔で楽しむ！" style="width: 100%; font-weight:bold;">
                            </div>

                            <div class="split-view-grid">
                                <div class="split-col">
                                    <div class="label-with-action">
                                        <label class="section-label"><i class="fa-regular fa-calendar"></i>
                                            今日のスケジュール</label>
                                        <button id="btn-get-schedule" class="btn-xs"
                                            title="GASでGoogle Calendar APIを有効にする必要があります"><i
                                                class="fa-solid fa-sync"></i>
                                            取得</button>
                                    </div>
                                    <textarea id="journal-calendar" class="journal-textarea sub-textarea"
                                        style="height: 220px !important; resize: none; overflow-y: auto; box-sizing: border-box;"
                                        placeholder="・10:00 会議..."></textarea>
                                </div>
                                <div class="split-col">
                                    <div class="label-with-action">
                                        <label class="section-label"><i class="fa-solid fa-utensils"></i>
                                            今日の食事内容</label>
                                        <div class="meal-actions">
                                            <button id="btn-meal-quick" class="btn-xs"
                                                title="1ボックスでまとめて入力"><i class="fa-solid fa-bolt"></i> 一括入力</button>
                                            <button id="btn-meal-ai" class="btn-xs"
                                                title="食事メモをAIで整形・栄養推定します"><i
                                                    class="fa-solid fa-wand-magic-sparkles"></i> AI整形</button>
                                            <button id="btn-meal-temp-save" class="btn-xs"
                                                title="途中でもローカルに一時保存"><i class="fa-solid fa-floppy-disk"></i>
                                                一時保存</button>
                                        </div>
                                    </div>
                                    <div id="meal-ui-container" class="meal-ui-container"
                                        style="min-height: 220px !important; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 1rem; box-sizing: border-box;">
                                        <div id="meal-quick-panel" class="meal-quick-panel">
                                            <div class="meal-quick-title">一括入力（朝/昼/夜/間食）</div>
                                            <textarea id="meal-quick-text"
                                                class="journal-textarea sub-textarea meal-quick-text"
                                                placeholder="例）朝: オートミール、卵&#10;昼: パスタ、サラダ&#10;夜: 魚、野菜&#10;間食: ナッツ"></textarea>
                                            <div class="meal-quick-actions">
                                                <button id="btn-meal-quick-apply" class="btn-xs"><i
                                                        class="fa-solid fa-share"></i> 4分割へ反映</button>
                                                <button id="btn-meal-quick-clear" class="btn-xs"><i
                                                        class="fa-solid fa-eraser"></i> クリア</button>
                                            </div>
                                        </div>
                                        <div class="meal-item">
                                            <span class="meal-label">朝</span>
                                            <textarea id="meal-breakfast" class="journal-textarea sub-textarea meal-textarea"
                                                placeholder="朝食の内容..."></textarea>
                                        </div>
                                        <div class="meal-item">
                                            <span class="meal-label">昼</span>
                                            <textarea id="meal-lunch" class="journal-textarea sub-textarea meal-textarea"
                                                placeholder="昼食の内容..."></textarea>
                                        </div>
                                        <div class="meal-item">
                                            <span class="meal-label">夜</span>
                                            <textarea id="meal-dinner" class="journal-textarea sub-textarea meal-textarea"
                                                placeholder="夕食の内容..."></textarea>
                                        </div>
                                        <div class="meal-item">
                                            <span class="meal-label">間食</span>
                                            <textarea id="meal-snack" class="journal-textarea sub-textarea meal-textarea"
                                                placeholder="間食の内容..."></textarea>
                                        </div>
                                    </div>
                                    <textarea id="journal-todo" class="journal-textarea sub-textarea"
                                        style="display: none;" placeholder="朝: ...&#10;昼: ..."></textarea>
                                </div>
                            </div>
                            <div class="split-view-grid" style="margin-top: 1rem;">
                                <div class="split-col">
                                    <div class="label-with-action">
                                        <label class="section-label"><i class="fa-solid fa-pen-nib"></i> 日記</label>
                                        <button id="btn-ai-writer" class="btn-xs" style="margin-left: 0.5rem;"
                                            title="書いた日記をAIが読みやすく整形・フィードバックします"><i
                                                class="fa-solid fa-wand-magic-sparkles"></i> AIライター</button>
                                    </div>
                                    <textarea id="journal-textarea" class="journal-textarea"
                                        style="height: 220px !important; resize: none; overflow-y: auto; box-sizing: border-box;"
                                        placeholder="・感想、気づき、メモ  ・今日自信がついた出来事は？  ・今日やり直せるとしたら何をする？"></textarea>
                                </div>
                                <div class="split-col">
                                    <div class="label-with-action">
                                        <label class="section-label"><i class="fa-solid fa-shoe-prints"></i>
                                            今日のアクティビティ履歴</label>
                                        <button id="btn-get-history" class="btn-xs"><i
                                                class="fa-solid fa-clock-rotate-left"></i> 履歴検索</button>
                                    </div>
                                    <textarea id="journal-activity" class="journal-textarea sub-textarea"
                                        style="height: 220px !important; resize: none; overflow-y: auto; box-sizing: border-box;"
                                        placeholder="履歴を自動取得、または手動で追記..."></textarea>
                                </div>
                            </div>
                            <div class="section-divider"
                                style="margin: 2rem 0; border-top: 1px solid rgba(255, 255, 255, 0.1);"></div>

                            <div id="section-score" class="form-group" style="margin-top: 2rem;">
                                <label class="section-label"><i class="fa-solid fa-star-half-stroke"></i>
                                    今日の行動の評価</label>
                                <!-- Description Removed -->
                                <div class="score-grid playful">
                                    <div class="score-item-playful">
                                        <div class="score-label">
                                            <span>心</span>
                                            <span class="score-sub-label">メンタルの調子は？</span>
                                        </div>
                                        <div class="star-row">
                                            <span class="star-hint">Low</span>
                                            <div class="star-rating" data-target="score-heart">
                                                <span class="star" data-value="1">★</span>
                                                <span class="star" data-value="2">★</span>
                                                <span class="star" data-value="3">★</span>
                                                <span class="star" data-value="4">★</span>
                                                <span class="star" data-value="5">★</span>
                                            </div>
                                            <span class="star-hint">High</span>
                                        </div>
                                        <input type="hidden" id="score-heart" value="5">
                                    </div>
                                    <div class="score-item-playful">
                                        <div class="score-label">
                                            <span>技</span>
                                            <span class="score-sub-label">新しい学びは？</span>
                                        </div>
                                        <div class="star-row">
                                            <span class="star-hint">Low</span>
                                            <div class="star-rating" data-target="score-skill">
                                                <span class="star" data-value="1">★</span>
                                                <span class="star" data-value="2">★</span>
                                                <span class="star" data-value="3">★</span>
                                                <span class="star" data-value="4">★</span>
                                                <span class="star" data-value="5">★</span>
                                            </div>
                                            <span class="star-hint">High</span>
                                        </div>
                                        <input type="hidden" id="score-skill" value="5">
                                    </div>
                                    <div class="score-item-playful">
                                        <div class="score-label">
                                            <span>体</span>
                                            <span class="score-sub-label">身体の調子は？</span>
                                        </div>
                                        <div class="star-row">
                                            <span class="star-hint">Low</span>
                                            <div class="star-rating" data-target="score-body">
                                                <span class="star" data-value="1">★</span>
                                                <span class="star" data-value="2">★</span>
                                                <span class="star" data-value="3">★</span>
                                                <span class="star" data-value="4">★</span>
                                                <span class="star" data-value="5">★</span>
                                            </div>
                                            <span class="star-hint">High</span>
                                        </div>
                                        <input type="hidden" id="score-body" value="5">
                                    </div>
                                    <div class="score-item-playful">
                                        <div class="score-label">
                                            <span>生活</span>
                                            <span class="score-sub-label">生活の満足度は？</span>
                                        </div>
                                        <div class="star-row">
                                            <span class="star-hint">Low</span>
                                            <div class="star-rating" data-target="score-life">
                                                <span class="star" data-value="1">★</span>
                                                <span class="star" data-value="2">★</span>
                                                <span class="star" data-value="3">★</span>
                                                <span class="star" data-value="4">★</span>
                                                <span class="star" data-value="5">★</span>
                                            </div>
                                            <span class="star-hint">High</span>
                                        </div>
                                        <input type="hidden" id="score-life" value="5">
                                    </div>
                                </div>
                            </div> <!-- Habit Grid moved here -->
                            <label class="section-label" style="display:block; margin-bottom: 0;"><i
                                    class="fa-solid fa-check-double"></i> 今日の習慣チェック</label>
                            <div class="habit-grid" style="margin-top: -1rem; margin-bottom: 2rem;"></div>
                        </div>
                    </div>

                    <div class="journal-actions">
                        <div class="act-left">
                            <button id="btn-temp-save" class="btn-outline-accent">一時保存</button>
                            <button id="btn-ai-format" class="btn-text" title="AIで文章を整える"><i
                                    class="fa-solid fa-wand-magic-sparkles"></i> AI整形</button>
                        </div>
                        <button id="btn-save-sync" class="btn-primary"><i class="fa-solid fa-cloud-arrow-up"></i> 保存 &
                            同期</button>
                    </div>
                    <div class="journal-bottom-links">
                        <a class="dash-link-btn" href="https://notebooklm.google.com/notebook/36ddcc11-1079-45d1-80f1-11db626e7664"
                            target="_blank" rel="noopener">日記を見る</a>
                        <a class="dash-link-btn"
                            href="https://docs.google.com/spreadsheets/d/1S7mzCdS7nYxyKq2bJ9GtHYnPpvb8Mh2oaeRdlOkT1Mw/edit?gid=0#gid=0"
                            target="_blank" rel="noopener">Sheet</a>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- AI Wizard Modal -->
    <div id="ai-wizard-modal" class="modal-overlay">
        <div class="modal wizard-modal">
            <div class="wizard-header">
                <h2><i class="fa-solid fa-robot"></i> 目標設定アシスタント</h2>
                <div class="step-indicator">
                    <span class="step active">1</span>
                    <span class="step">2</span>
                    <span class="step">3</span>
                    <span class="step">4</span>
                    <span class="step">5</span>
                </div>
            </div>

            <div class="wizard-content" id="wizard-content">
                <!-- Slides will be injected dynamically -->
            </div>

            <div class="wizard-footer">
                <div style="display: flex; gap: 10px;">
                    <button id="btn-wiz-cancel" class="btn-secondary">キャンセル</button>
                    <button id="btn-wiz-save" class="btn-outline-accent"><i class="fa-solid fa-floppy-disk"></i>
                        一時保存</button>
                </div>
                <div style="display:flex; gap:10px;">
                    <button id="btn-wiz-prev" class="btn-secondary" style="display:none;">戻る</button>
                    <button id="btn-wiz-next" class="btn-primary">次へ <i class="fa-solid fa-arrow-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal">
            <h2><i class="fa-solid fa-gear"></i> 設定</h2>

            <div class="form-group">
                <label>GAS Web App URL (データを送信)</label>
                <input type="text" id="config-gas-url" style="width: 100%;"
                    placeholder="https://script.google.com/macros/s/...">
            </div>

            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label>スプレッドシート URL</label>
                    <a id="link-ss-url" href="#" target="_blank"
                        style="font-size: 0.8rem; color: var(--accent-gold); text-decoration: none; display: none;">
                        <i class="fa-solid fa-external-link-alt"></i> 開く
                    </a>
                </div>
                <input type="text" id="config-ss-url" style="width: 100%;"
                    placeholder="https://docs.google.com/spreadsheets/d/...">
            </div>

            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label>NotebookLM URL</label>
                    <a id="link-notebook-url" href="#" target="_blank"
                        style="font-size: 0.8rem; color: var(--accent-gold); text-decoration: none; display: none;">
                        <i class="fa-solid fa-external-link-alt"></i> 開く
                    </a>
                </div>
                <input type="text" id="config-notebook-url" style="width: 100%;"
                    placeholder="https://notebooklm.google.com/notebook/...">
            </div>

            <div class="form-group">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <label>Gemini API Key (AI整形用)</label>
                    <a href="https://aistudio.google.com/app/api-keys" target="_blank"
                        style="font-size: 0.8rem; color: var(--accent-gold); text-decoration: none;">
                        <i class="fa-solid fa-external-link-alt"></i> キーを取得
                    </a>
                </div>
                <input type="password" id="config-gemini-key" style="width: 100%;" placeholder="AIza...">
            </div>

            <div class="form-group">
                <label>AI整形プロンプト (任意)</label>
                <textarea id="config-custom-prompt" style="width: 100%; height: 120px; font-size: 0.9rem;"
                    placeholder="以下の文章を日記として読みやすく整形してください。内容は変えず、誤字脱字の修正や言い回しの改善のみを行ってください。アドバイスや感想、追加の質問は一切不要です。出力は整形後の本文のみにしてください。"></textarea>
            </div>

            <div style="display: flex; justify-content: flex-end; margin-top: 2rem;">
                <button id="btn-close-settings" class="btn-secondary">キャンセル</button>
                <button id="btn-save-settings" class="btn-primary">保存</button>
            </div>
        </div>
    </div>

    <!-- Meal AI Result Modal -->
    <div class="modal-overlay" id="meal-ai-modal">
        <div class="modal">
            <h2><i class="fa-solid fa-utensils"></i> 食事AI結果</h2>

            <div class="meal-ai-section">
                <label class="meal-ai-label">整形サマリ</label>
                <div id="meal-ai-summary" class="meal-ai-summary">-</div>
            </div>

            <div class="meal-ai-section">
                <label class="meal-ai-label">栄養推定</label>
                <div id="meal-ai-nutrition" class="meal-ai-nutrition"></div>
            </div>

            <div class="meal-ai-section">
                <label class="meal-ai-label">JSON</label>
                <textarea id="meal-ai-json" class="meal-ai-json" readonly></textarea>
            </div>

            <div class="meal-ai-actions">
                <button id="btn-meal-ai-save" class="btn-primary">保存</button>
                <button id="btn-meal-ai-copy" class="btn-outline-accent">JSONコピー</button>
                <button id="btn-meal-ai-close" class="btn-secondary">閉じる</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>
